<!doctype html>
<html lang="zh-tw">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="eMPOWER華語文字詞句教學平台">
<meta name="author" content="eMPOWER華語文字詞句教學平台">
<title>你問我答 | eMPOWER華語文字詞句教學平台</title>
<link rel="shortcut icon" type="image/x-icon" href="../../Content/images/eMPOWER.ico">
<link rel="stylesheet" type="text/css" href="../../Content/css/bootstrap_custom.css">
<link rel="stylesheet" type="text/css" href="../../Content/widgets/fontawesome-free-5.15.3-web/css/all.css">
<!-- core CSS -->
<link rel="stylesheet" type="text/css" href="../../Content/css/CA2.css">
</head>

<body>
<form>
  <div class="container-fluid CA-block CA-openQ">
    <div class="row"> 
      <!-- left start -->
      <div class="col-lg-8 bg-pure order-2 order-lg-1">
        <div class="row h-100 align-items-center"> 
          <!-- 頭像&等待 start -->
          <div class="CA-welcomeWait STEP1">
            <h2>&nbsp;&nbsp;&nbsp;&nbsp;歡迎！</h2>
            <div class="contestant mb-5">
              <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_1.png" alt=""/></div>
              Lawrence</div>
            <h3>等待活動開始/等待下一題</h3>
          </div>
          <!-- 頭像&等待  end  --> 
          <!-- 題目填答區 start -->
          <div class="h-100 STEP2">
            <div class="row justify-content-center h-100">
              <div class="col-12 col-xxl-10 d-flex flex-column h-100 justify-content-around"> 
                <!-- -->
                <div class="CA-topic my-3">
                  <div class="CA-topic-circle"> <span class="topic-circle-num">1</span> <span class="topic-circle-text">她為什麼不吃飯？</span> </div>
                  <div class="row gx-2 gx-xl-3 align-items-center justify-content-center CA-topic-pic">
                    <div class="col-4">
                      <button type="button" class="btn btn-light w-100 CA-lightbox">
                      <div class="ratio ratio-4x3"> <img src="../../Content/images/index/canHelp-teacher-img.png" alt="canHelp-teacher-img.png" class="img-fluid"/> </div>
                      </button>
                    </div>
                    <div class="col-4">
                      <button type="button" class="btn btn-light w-100 CA-lightbox">
                      <div class="ratio ratio-4x3"> <img src="../../Content/images/index/canHelp-teacher-img.png" alt="canHelp-teacher-img.png" class="img-fluid"/> </div>
                      </button>
                    </div>
                    <div class="col-4">
                      <button type="button" class="btn btn-light w-100 CA-lightbox">
                      <div class="ratio ratio-4x3"> <img src="../../Content/images/index/canHelp-teacher-img.png" alt="canHelp-teacher-img.png" class="img-fluid"/> </div>
                      </button>
                    </div>
                  </div>
                </div>
                <!-- -->
                <div class="CA-ansDialogue my-3">
                  <div class="contestant">
                    <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_1.png" alt=""/></div>
                    Lawrence Natividad</div>
                  <div class="ansDialogue-block">
                    <div class="ansMethod type h-100">
                      <textarea class="form-control h-100 border-0" id="" rows="3" placeholder="請在此作答..."></textarea>
                    </div>
                    <div class="ansMethod pic h-100">
                      <button type="button" class="btn btn-cyan rounded-circle btn-expand" id="EXPAND"><i class="fas fa-expand" title="最大化"></i></button>
                      <iframe src="palette.html" scrolling="no" frameborder="0" width="100%" height="100%" id="PALETTE"> </iframe>
                    </div>
                  </div>
                </div>
                <!-- -->
                <div class="my-3 ms-auto">
                  <button type="button" class="btn btn-cyan " id="SUBMIT">提交</button>
                </div>
                <!-- --> 
              </div>
            </div>
          </div>
          <!-- 題目填答區  end  --> 
        </div>
      </div>
      <!-- left end --> 
      <!-- right start -->
      <div class="col-lg-4 bg-grid order-1 order-lg-2 position-fixed end-0">
        <div class="row h-100 justify-content-center align-content-center">
          <div class="col-4 col-md-3 col-lg-10 mb-lg-5 d-flex flex-column justify-content-center">
            <div class="CA-logo"> <img src="../../Content/images/eMPOWER-img.svg" alt="eMPOWER"/>
              <h1 class="d-none d-lg-block">你問我答</h1>
            </div>
          </div>
          <div class="col-8 col-lg-10 mb-lg-5">
            <div class="row align-items-center">
              <div class="col-auto ms-auto col-lg-12 text-center mb-lg-3"> <span class="text-cyan display-6 fw-bold" id="COUNTER">--:--</span> </div>
            </div>
          </div>
          <div class="col-8 col-lg-10 mb-lg-5">
            <div class="row align-items-center">
              <div class="col-auto pe-1"> <span class="text-cyan progress-pre">0%</span> </div>
              <div class="col ps-1">
                <div class="progress rounded-pill">
                  <div id="Sbar" class="progress-bar bg-cyan" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- right end --> 
    </div>
  </div>
  <!-- (STEP3)活動結束 start -->
  <div class="modal CA-end" id="CA-end" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">
        <div class="modal-body">
          <div class="end-title">活動完成</div>
          <div class="end-close">
            <button class="btn btn-cyan" type="button" id="CLOSEWIN">關閉視窗</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- (STEP3)活動結束 end -->
</form>
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<script src="../../Script/bootstrap.bundle.min.js">//BS5 js</script> 
<script src="../../Content/js/modal-lightbox.js">//modal lightbox</script> 
<script> 
//僅demo 非正式前端
const STEP1 = document.querySelectorAll('.STEP1'),
      STEP2 = document.querySelectorAll('.STEP2');

const SUBMIT = document.querySelector('#SUBMIT'),
      COUNTER = document.querySelector('#COUNTER'),
      CLOSEWIN = document.querySelector('#CLOSEWIN'); 
    
const endModal = new bootstrap.Modal(document.querySelector('#CA-end'));    
    
const dataQ = [
    {
        "topic": "她為什麼不吃飯？",
        "ansMethod": "type",
        "pic": ["../../Content/images/index/materials/jimu1bookcover.jpg", 
                "../../Content/images/index/banner-img_zh-CN.png",
                "../../Content/images/classActivity/avatar/avatar_21.png"],
        "min": 1,
        "sec": 30
    },
    {
        "topic": "這是什麼？",
        "ansMethod": "pic",
        "pic": ["../../Content/images/index/materials/learn_1_cover.png", 
                "../../Content/images/index/materials/learn_5_cover.png"],
        "min": 1,
        "sec": 30
    }
];
    
//STEP1
function showSTEP1(){
    STEP1.forEach(el => {
      el.style.display = '';
    }); 
    STEP2.forEach(el => {
      el.style.display = 'none';
    });  
}
//STEP2
function showSTEP2(){
    STEP1.forEach(el => {
      el.style.display = 'none';
    }); 
    STEP2.forEach(el => {
      el.style.display = '';
    });  
}   

//顯示等待 
function waiting(state, text){ //state: [start|next|end]
    showSTEP1();
    
    document.querySelector('.CA-welcomeWait').classList.add(state);//狀態不同，CA-welcomeWait顯示區塊不同
    document.querySelector('.CA-welcomeWait h3').textContent = text;
    
    clearInterval(intervalCounter);
    COUNTER.innerHTML = ' ';
}
    
//demo5秒後進入下一題  (進入下一題實際由題目時間、老師按鈕控制)  
let timerNextQ;    
function goNextQ(){
   timerNextQ = setTimeout(() => {
        showTopic(currentIndex);
        progress(currentIndex);
        countdownTimer(dataQ[currentIndex].min, dataQ[currentIndex].sec);

        currentIndex ++;
    }, 5000);   
} 

//顯示題目    
function showTopic(i){
    //顯示SETP區塊
    showSTEP2();
    
    //顯示題號、題目
    document.querySelector('.topic-circle-num').textContent = i+1; 
    document.querySelector('.topic-circle-text').textContent = dataQ[i].topic;
    
    //顯示圖片
    let imgHTML = '';
    for(let j=0; j<dataQ[i].pic.length; j++){
        imgHTML += `<div class="col-4">
                        <button type="button" class="btn btn-light w-100 CA-lightbox">
                        <div class="ratio ratio-4x3"> <img src="`+ dataQ[i].pic[j] +`" class="img-fluid"/> </div>
                        </button>
                      </div>`; 
    }
    document.querySelector('.CA-topic-pic').innerHTML = imgHTML;
    
    //顯示作答方式
    let allMethods = document.querySelectorAll('.ansMethod');
    allMethods.forEach(el => {
        if (el.classList.contains(dataQ[i].ansMethod)) {
            el.style.display = 'block';
        } else {
            el.style.display = 'none';
        }
    }); 
    
    //call lightbox
    lightBox();
}  
    
//判斷下一題或結束
function judge(){
    //若有lightbox，則移除
    const modalElement = document.querySelector('#modal-lightbox'); 
    if(modalElement){
        document.querySelector('#modal-lightbox').remove();       
        document.querySelector('.modal-backdrop').remove(); 
    }
                  
    if(currentIndex === dataQ.length){//最後一題，則出現end modal
        waiting('end', '');

        endModal.show();  
    }else{
        waiting('next', '等待下一題'); 
        
        goNextQ();
    }
}  

//顯示倒數計時
let intervalCounter;    
function countdownTimer(min, sec) {
    let totalSeconds = min * 60 + sec;

    intervalCounter = setInterval(() => {
        let mins = Math.floor(totalSeconds / 60);
        let secs = totalSeconds % 60;
        let timeFormat = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        COUNTER.textContent = timeFormat;

        if (totalSeconds <= 0) {  
            clearInterval(intervalCounter);
            judge();                    
        }

        totalSeconds--;
    }, 1000);
} 
    
//顯示進度
function progress(i){
    const progress = document.querySelector('#Sbar'); 
    
    let p = Math.round(Number(i+1)/dataQ.length*100); 
    progress.style.width = p+'%';
    progress.setAttribute('aria-valuenow', p);
    document.querySelector('.progress-pre').textContent = p+'%';
}

    
let currentIndex = 0; 
showSTEP1();    
waiting('satrt', '等待活動開始'); 
goNextQ();        
    
//[提交]
SUBMIT.addEventListener('click', () => {
    judge();
}); 

//[關閉視窗]   
CLOSEWIN.addEventListener('click', ()=>{
    window.close();
});   
</script> 
<script> 
//放大/縮小繪圖板    
const PALETTE = document.getElementById('PALETTE');   
const EXPAND = document.getElementById('EXPAND'); 
   
EXPAND.addEventListener('click', ()=>{
    expandIframe();
});      

function expandIframe() {//放大繪圖板  
    PALETTE.classList.add('expanding');
    
    PALETTE.insertAdjacentHTML('beforeBegin', `<button type="button" class="btn btn-cyan rounded-circle btn-compress" id="COMPRESS" title="向下還原"><i class="fas fa-compress"></i></button>`);
    
    const COMPRESS = document.getElementById('COMPRESS');   
    COMPRESS.addEventListener('click', ()=>{
        compressIframe();
    }); 
}    
  
function compressIframe() {//縮小繪圖板    
    PALETTE.classList.remove('expanding');
    
    if (COMPRESS) {
        COMPRESS.parentNode.removeChild(COMPRESS);
    }
}      
</script> 
<script src="../../Content/js/previeMark2.js">//若為教師預覽加效果</script> 
<script> //教師預覽 控制左右箭頭
if( user == 't' ){
    let page = 0; 
    previewPage(page);
    
    NEXT.addEventListener('click', () => { 
        page++;
        previewPage(page);
    });
    
    PREV.addEventListener('click', () => {  
        page--;
        previewPage(page);
    });
}   
function previewPage(page){  
    currentIndex = page - 1;
    
    if ( page<0 ){ //登入頁
       history.back();
    } 
    else if ( page===0 ){ //等待活動開始頁
        endModal.hide();
        
        showSTEP1();    
        waiting('satrt', '等待活動開始'); 
        clearTimeout(timerNextQ); 
        
        PREV.classList.remove('disabled');
        NEXT.classList.remove('disabled');
    } 
    else if ( page>0 && page<=dataQ.length ){ //題目
        endModal.hide();
        
        showTopic(currentIndex); 
        progress(currentIndex);
        clearInterval(intervalCounter);
        COUNTER.textContent = dataQ[currentIndex].min+':'+dataQ[currentIndex].sec;   
        
        PREV.classList.remove('disabled');
        NEXT.classList.remove('disabled');
    }  
    else if ( page>dataQ.length ){ //活動完成
        waiting('end', '');

        endModal.show();  
        
        PREV.classList.remove('disabled');
        NEXT.classList.add('disabled');
    }                    
}    
</script>
</body>
</html>

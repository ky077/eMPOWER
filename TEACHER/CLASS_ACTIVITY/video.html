<!doctype html>
<html lang="zh-tw">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="eMPOWER華語文字詞句教學平台">
<meta name="author" content="eMPOWER華語文字詞句教學平台">
<title>看影片回答問題活動進行頁面 | eMPOWER華語文字詞句教學平台</title>
<link rel="shortcut icon" type="image/x-icon" href="../../Content/images/eMPOWER.ico">
<link rel="stylesheet" type="text/css" href="../../Content/css/bootstrap_custom.css">
<link rel="stylesheet" type="text/css" href="../../Content/widgets/fontawesome-free-5.15.3-web/css/all.css">
<!-- core CSS -->
<link rel="stylesheet" type="text/css" href="../../Content/css/CA2.css">
</head>

<body>
<form>
  <div class="container-fluid CA-block CA-video">
    <div class="row"> 
      <!-- left start -->
      <div class="col-lg-4 bg-grid position-fixed">
        <div class="row h-100 justify-content-center align-content-center">
          <div class="col-12 py-3 order-1">
            <div class="row justify-content-center">
              <div class="col-4 col-lg-10 d-flex flex-column justify-content-center">
                <div class="CA-logo"> <img src="../../Content/images/eMPOWER-img.svg" alt="eMPOWER"/>
                  <h1 class="d-none d-lg-block">看影片回答問題</h1>
                </div>
              </div>
              <div class="col-8 col-lg-10 mb-lg-5 d-block d-lg-none">
                <h2 class="mb-0 h3">看影片回答問題</h2>
              </div>
            </div>
          </div>
          <div class="col-6 col-sm-6 mb-4 mt-lg-5 CA-code order-3">
            <h2 class="h6 text-center mb-2 fw-normal">活動代碼</h2>
            <div class="form-control rounded-0 text-center col-6 fs-2 fw-bold">545612</div>
          </div>
          <div class="w-100 order-4"></div>
          <div class="col-6 CA-QRcode mb-4 order-5"> <img src="../../Content/temp/qr-listeningEnter.png" alt="" class="w-100"/> </div>
        </div>
      </div>
      <!-- left end --> 
      <!-- right start -->
      <div class="col-lg-8 bg-pure ms-auto">
        <div class="row justify-content-center align-content-center CA-video-Qsection"> 
          <!-- 歡迎標語 start -->
          <div class="CA-welcomeWait mb-5 STEP1">
            <h2>&nbsp;&nbsp;歡迎！</h2>
            <h3>等待所有人加入</h3>
          </div>
          <!-- 歡迎標語 end --> 

          <!-- 題目與計時 start -->
          <div class="CA-topic mb-4 STEP2">
            <div class="row justify-content-center">
              <div class="col-12 col-xxl-11">
                <div class="row gx-2 align-items-center">
                  <div class="col">
                    <div class="CA-topic-circle"><span class="topic-circle-num">1</span> <span class="topic-circle-text">她為什麼不吃飯？</span></div>
                  </div>
                  <div class="col-auto">
                    <div class="CA-counter"><label id="COUNTER">00:00</label></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- 題目與計時 end --> 

          <!-- 參加、作答情況 start -->
          <div class="CA-board STEP1 STEP2">
            <div class="row justify-content-center">
              <div class="col-12 col-xxl-11 position-relative">
                <div class="board-btns">
                  <button class="btn btn-lg btn-cyan" type="button" id="NEXT">開始/下一題/完成</button>
                </div>
                <div class="board-circles">
                  <div class="CA-circle">
                    <div class="circle-wrap bg-white text-cyan border-cyan">
                      <div class="circle-text">
                        <div>參加人數</div>
                        <div class="display-6 fw-bold" id="JOINNUM">0</div>
                      </div>
                    </div>
                  </div>
                  <div class="CA-circle STEP2">
                    <div class="circle-wrap bg-cyan text-white border-cyan">
                      <div class="circle-text">
                        <div>完成人數</div>
                        <div class="display-6 fw-bold" id="DONENUM">0</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="board-block">
                  <div class="STEP1"> 
                    <!-- 參加情況 start -->
                    <div class="board-contestants">
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_1.png" alt=""/></div>
                        Amy</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_21.png" alt=""/></div>
                        Cathy</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_15.png" alt=""/></div>
                        Brain</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_33.png" alt=""/></div>
                        Daren D. Daren</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_12.png" alt=""/></div>
                        Christina</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_7.png" alt=""/></div>
                        Eddie</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_48.png" alt=""/></div>
                        Zoe</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_56.png" alt=""/></div>
                        Bob</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_25.png" alt=""/></div>
                        John</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_48.png" alt=""/></div>
                        Alex</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_46.png" alt=""/></div>
                        Natividad</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_18.png" alt=""/></div>
                        Merry</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_34.png" alt=""/></div>
                        Kevin</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_37.png" alt=""/></div>
                        Lawrence</div>
                      <div class="contestant">
                        <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_29.png" alt=""/></div>
                        OliverOliver Oliver</div>
                    </div>
                    <!-- 參加情況 end --> 
                  </div>
                  <div class="STEP2"> 
                    <!-- 作答情況 start -->
                    <div class="ansMethod type">
                      <button class="CA-collapse-list" type="button" data-bs-toggle="collapse" data-bs-target=".dialogueChat-name" aria-expanded="false">展開名單</button>    
                      <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3">
                        <div class="col">
                          <div class="CA-dialogueChat">
                            <div class="dialogueChat-name collapse">Amy</div>
                            <div class="dialogueChat-text">她喝太多咖啡了，肚子痛。</div>
                          </div>
                        </div>
                        <div class="col">
                          <div class="CA-dialogueChat">
                            <div class="dialogueChat-name collapse">Amy</div>
                            <div class="dialogueChat-text">因為她肚子痛。</div>
                          </div>
                        </div>
                        <div class="col">
                          <div class="CA-dialogueChat">
                            <div class="dialogueChat-name collapse">Amy</div>
                            <div class="dialogueChat-text">她喝太多咖啡了，肚子痛。</div>
                          </div>
                        </div>
                        <div class="col">
                          <div class="CA-dialogueChat">
                            <div class="dialogueChat-name collapse">Amy</div>
                            <div class="dialogueChat-text">她胃痛，所以不能吃飯。</div>
                          </div>
                        </div>
                        <div class="col">
                          <div class="CA-dialogueChat">
                            <div class="dialogueChat-name collapse">Amy</div>
                            <div class="dialogueChat-text">她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了，肚子痛。</div>
                          </div>
                        </div>
                        <div class="col">
                          <div class="CA-dialogueChat">
                            <div class="dialogueChat-name collapse">Amy</div>
                            <div class="dialogueChat-text">她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了，肚子痛。</div>
                          </div>
                        </div>
                        <div class="col">
                          <div class="CA-dialogueChat">
                            <div class="dialogueChat-name collapse">Amy</div>
                            <div class="dialogueChat-text">她喝太多咖啡了，肚子痛。</div>
                          </div>
                        </div>
                        <div class="col">
                          <div class="CA-dialogueChat">
                            <div class="dialogueChat-name collapse">Amy</div>
                            <div class="dialogueChat-text">因為她肚子痛痛痛痛痛痛痛痛痛痛痛痛痛痛痛痛痛。</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="ansMethod check">
                        <button class="CA-collapse-list" type="button" data-bs-toggle="collapse" data-bs-target=".poll-bar-name" aria-expanded="false">展開名單</button>
                        <div class="CA-poll-barArea">
                          <div class="CA-poll-bar">
                            <div class="poll-bar-title"><span>A.</span><span>他肚子痛。</span></div>
                            <div class="poll-bar-bar" style="width: 13%;"><span>13%</span></div>
                            <div class="poll-bar-name collapse">Amy、Cathy、Brain、Daren D.Daren、Christina</div>
                          </div>
                          <div class="CA-poll-bar top1">
                            <div class="poll-bar-title"><span>B.</span><span>他喝太多咖啡。</span></div>
                            <div class="poll-bar-bar" style="width: 100%;"><span>100%</span></div>
                            <div class="poll-bar-name collapse">Amy、Cathy、Brain、Daren D.Daren、Christina、Amy、Cathy、Brain、Daren D.Daren、Christina、Amy、Cathy、Brain、Daren D.Daren、Christina</div>
                          </div>
                          <div class="CA-poll-bar">
                            <div class="poll-bar-title"><span>C.</span><span>因為他正在減肥。</span></div>
                            <div class="poll-bar-bar" style="width: 50%;"><span>50%</span></div>
                            <div class="poll-bar-name collapse">Amy、Cathy、Brain、Daren D.Daren、Christina</div>
                          </div>
                          <div class="CA-poll-bar">
                            <div class="poll-bar-title"><span>D.</span><span> 她等一下吃。</span></div>
                            <div class="poll-bar-bar" style="width: 0%;"><span>0%</span></div>
                            <div class="poll-bar-name collapse"></div>
                          </div>
                        </div>  
                    </div>
                    <!-- 作答情況 end --> 
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- 參加、作答情況 end --> 
        </div>
          
        <div class="position-absolute top-0 start-0 end-0 CA-video-Vsection">
            <!-- 影片start -->  
            <div class="CA-video-iframe">
              <img src="" id="ytDefault" style="display: none"/>  
              <div id="ytplayer"></div>
            </div>
            <!-- 影片 end -->
            <!-- 播放器 start -->  
            <div class="CA-video-player">
              <div class="em-player">
                <div class="em-player__control">
                  <button type="button" class="em-btn em-play"></button>
                  <button type="button" class="em-btn em-pause" style="display: none;"></button>
                </div>
                <div class="em-player__Nowsec">00:00</div>
                <div class="em-player__progress">
                  <div class="progress">
                  </div>
                </div>
                <div class="em-player__totalSec">13:00</div>
              </div>
            </div>
            <!-- 播放器 end -->  
          </div>  
      </div>
      <!-- right end --> 
    </div>
  </div>
  <!-- 活動結束 start -->
  <div class="modal CA-end zoom" id="CA-end" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">
        <div class="modal-body">
          <div class="end-title">活動結束</div>
          <a href="../../Content/temp/video-pdf.pdf" class="end-download" download><i class="fas fa-download"></i></a>
          <div class="end-remark">若需要此次活動紀錄，請馬上下載。<br>
            關閉頁面就下載不到囉！<!--If you need records of this event, please download it now.<br>
Once the page is closed, this record cannot be downloaded.--></div>
          <div class="end-close">
            <button class="btn btn-cyan" type="button" id="CLOSEWIN">關閉視窗</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 活動結束 end -->
</form>
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<script src="../../Script/bootstrap.bundle.min.js">//BS5 js</script> 
<script src="../../Script/jquery.min.js"></script>      
<script src="../../Content/widgets/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script> 
<script src="../../Content/widgets/jquery-ui-1.12.1.custom/jquery.ui.touch-punch.min.js"></script>     
<script src="https://www.youtube.com/iframe_api"></script>    
  
<script>
//僅demo 非正式前端
const STEP1 = document.querySelectorAll('.STEP1'),
      STEP2 = document.querySelectorAll('.STEP2'),
      VIDEO = document.querySelectorAll('.CA-video-Vsection');
	
const JOINNUM = document.querySelector('#JOINNUM'),
	  DONENUM = document.querySelector('#DONENUM');
	
const NEXT = document.querySelector('#NEXT'); 
	
const COUNTER = document.querySelector('#COUNTER');
    
const endModal = new bootstrap.Modal(document.querySelector('#CA-end'));        
    
const dataQ = {
    "ytId": "2tlmHypKQ44",
    "clipStart": 20,
    "clipEnd": 100,
    "topics": [
        {
            "topicId": "1",
            "sec": 30,
            "topic": "這是什麼？",
            "ansMethod": "type",
            "option": [],
            "ansMin": 0,
            "ansSec": 10
        },
        {
            "topicId": "2",
            "sec": 80,
            "topic": "她為什麼不吃飯？",
            "ansMethod": "check",
            "option": ["她肚子痛。", "她喝太多咖啡了。", "因為她正在減肥。", "她等一下吃。"],
            "ansMin": 0,
            "ansSec": 20
        }
    ]
}; 
    
let player;
let playerInitialized = false; 
let interval = null; 
    
const progress = $('.em-player__progress .progress');      

//STEP1
function showSTEP1(){
    STEP1.forEach(el => {
      el.style.display = '';
    }); 
    STEP2.forEach(el => {
      el.style.display = 'none';
      if( el.classList.contains('STEP1') ){
        el.style.display = '';     
      }
    }); 
    VIDEO.forEach(el => {
      el.style.display = 'none';
    });
    
    document.querySelector('.CA-video-Qsection').classList.remove('CA-backdrop');
}
//STEP2
function showSTEP2(){
    STEP1.forEach(el => {
      el.style.display = 'none';
    }); 
    STEP2.forEach(el => {
      el.style.display = '';
    });
    VIDEO.forEach(el => {
      el.style.display = '';
    });
    
    document.querySelector('.CA-video-Qsection').classList.add('CA-backdrop');
}   
//VIDEO
function showVIDEO(){
    STEP1.forEach(el => {
      el.style.display = 'none';
    }); 
    STEP2.forEach(el => {
      el.style.display = 'none';
    });
    VIDEO.forEach(el => {
      el.style.display = '';
    });
    
    document.querySelector('.CA-video-Qsection').classList.remove('CA-backdrop');
}      
    
//顯示題目    
function showTopic(i){ 
    //顯示STEP區域
    showSTEP2(); 

    //顯示題號、題目
    document.querySelector('.topic-circle-num').textContent = i+1; 
    document.querySelector('.topic-circle-text').textContent = dataQ.topics[i].topic;
    
    //顯示作答方式
    let allMethods = document.querySelectorAll('.ansMethod');
    allMethods.forEach(el => {
        if (el.classList.contains(dataQ.topics[i].ansMethod)) {
            el.style.display = 'block';
        } else {
            el.style.display = 'none';
        }
    });
    
    if( dataQ.topics[i].ansMethod === 'check'){
        //顯示選項版型
        let optionHTML = "";
        for (let j=0; j<dataQ.topics[i].option.length; j++) {
            optionHTML += `<div class="CA-poll-bar">
                              <div class="poll-bar-title"><span>` + String.fromCharCode((j+1) + 64) + `.</span><span>` + dataQ.topics[i].option[j] + `</span></div>
                              <div class="poll-bar-bar" style="width:0%;"><span>0%</span></div>
                              <div class="poll-bar-name collapse"></div>
                            </div>`;
        }      
        document.querySelector('.CA-poll-barArea').innerHTML = optionHTML;  
    }
    
    //[展開/隱藏名單] 預設
    document.querySelector('.CA-collapse-list').textContent = '展開名單';
    document.querySelector('.CA-collapse-list').setAttribute('aria-expanded', false);
    
    //設定[展開/隱藏名單]位置             
    CollapseBtnPosition();  

    //[展開/隱藏名單]文字切換、collapse效果
    CollapseBtnToggle();
}  
    
//設定[展開/隱藏名單]位置
function CollapseBtnPosition(){
    const collapseButtons = document.querySelectorAll('.CA-collapse-list');
    
    collapseButtons.forEach(collapseButton => {
        const rect = document.querySelector('.board-block').getBoundingClientRect(); 
        let rectTop = rect.top 
        let rectRight = rect.right;

        collapseButton.style.top = rectTop + 15 + 'px';
        collapseButton.style.left = rectRight - 20 + 'px'; 
    });  
}       
window.addEventListener('scroll', CollapseBtnPosition); 
window.addEventListener('resize', CollapseBtnPosition); 
    
//[展開/隱藏名單]文字切換、collapse效果
function CollapseBtnToggle(){
    const collapseButtons = document.querySelectorAll('.CA-collapse-list');
    
    collapseButtons.forEach(collapseButton => {  
        collapseButton.addEventListener('click', () => { 
            let expanded = collapseButton.getAttribute('aria-expanded');
            
            if(expanded == 'true'){
                collapseButton.textContent = '隱藏名單';   
                
                //(check)顯示箭頭
                const arrowElement = collapseButton.nextElementSibling.getElementsByClassName('poll-bar-bar'); 
                for (var i = 0; i < arrowElement.length; i++) {
                    arrowElement[i].classList.add('show');
                }
            }else{
                collapseButton.textContent = '展開名單';
                
                //(check)隱藏箭頭 
                const arrowElement = collapseButton.nextElementSibling.getElementsByClassName('poll-bar-bar');
                for (var i = 0; i < arrowElement.length; i++) {
                    arrowElement[i].classList.remove('show');
                }
            }
        });
    });
}        
    
//顯示按鈕文字
function showBtn(i){
    if( i === 0 ){
        NEXT.innerHTML = '開始';
    }else{
        NEXT.innerHTML = '繼續播放'; 
    }
}
    
//卷軸捲動到下方
function scrollToBottom() {
    const scrollingDiv = document.querySelector('.board-block');   
    scrollingDiv.scrollTop = scrollingDiv.scrollHeight;
} 
    
//倒數計時
let timerInterval;    
function countdownTimer(min, sec) { console.log(min + ' / ' + sec)
    let totalSeconds = min * 60 + sec;

    timerInterval = setInterval(() => {
        let mins = Math.floor(totalSeconds / 60);
        let secs = totalSeconds % 60;
        let timeFormat = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        COUNTER.textContent = timeFormat;  console.log(timeFormat)

        if (totalSeconds <= 0) {  
            clearTimer();                 
        }

        totalSeconds--;
    }, 1000);
} 
function clearTimer() {
    clearInterval(timerInterval);
}     
	
//參加人數
function joinNum(){
	let join = document.querySelectorAll('.board-contestants .contestant');
    JOINNUM.innerHTML = join.length; 
}
	
//完成人數
function doneNum(ansMethod, i){
    if(ansMethod === 'type'){
        let done = document.querySelectorAll('.ansMethod.'+ansMethod+' > .row > div');
        DONENUM.innerHTML = done.length; 
    }
    if(ansMethod ==='check'){
        DONENUM.innerHTML = i+1;    
    }
}	

//隨機數字 
function getRandomNumber(min, max) {
	return Math.floor(Math.random() * (max - min + 1)) + min;
} 	

//demo 學生進入
function demoSenter(){
	const dataAvater = [
		{
			"user": "Amy",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Brian",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Christina C. Kathy",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Daren D. Daren",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Eddie Van Halen",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Karen",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Zoe",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Bob",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "John",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Alex",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Natividad",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Merry",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Kevin",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Lawrence",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "OliverOliver Oliver",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Taylor Alison Swift",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Peter Gene Hernandez",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Halsey",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Kelly Clarkson",
			"avater": getRandomNumber(1, 56) 
		},
		{
			"user": "Justin",
			"avater": getRandomNumber(1, 56) 
		}    
	];
	
	let i = 0;
	
	const content = document.querySelector('.board-contestants');
		  content.innerHTML = '';
	
	let intervalId = setInterval(() => {
		if (i >= dataAvater.length) {
			clearInterval(intervalId);
			return;
		}

		html = `<div class="contestant">
                      <div class="avater"><img src="../../Content/images/classActivity/avatar/avatar_` + dataAvater[i].avater + `.png" alt=""/></div>
                      ` + dataAvater[i].user + `</div>`;

		content.insertAdjacentHTML('beforeend', html);
		
		//參加人數
		joinNum();

		//卷軸保持在下方
		scrollToBottom(); 
		
		i++;
	}, 1200);
	
	NEXT.addEventListener('click', () => {
		if( JOINNUM.textContent != '0' ){
			clearInterval(intervalId);
		}
	});
}	

//demo 學生回答	
function demoSans(ansMethod){ 
	let DataSans = [];
	if(ansMethod === 'type'){
		DataSans = [
			{
				"name": "Amy",
				"ans": "她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "Justin",
				"ans": "因為她肚子痛。"
			},
			{
				"name": "Brian",
				"ans": "她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "Kelly Clarkson",
				"ans": "她胃痛，所以不能吃飯。"
			},
			{
				"name": "Christina C. Kathy",
				"ans": "她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "Halsey",
				"ans": "她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "Daren D. Daren",
				"ans": "她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "Peter Gene Hernandez",
				"ans": "因為她肚子痛痛痛痛痛痛痛痛痛痛痛痛痛痛痛痛痛。"
			},
			{
				"name": "Eddie Van Halen",
				"ans": "她胃痛，所以不能吃飯。"
			},
			{
				"name": "Taylor Alison Swift",
				"ans": "她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "Karen",
				"ans": "她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "OliverOliver Oliver",
				"ans": "她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "Zoe",
				"ans": "因為她肚子痛痛痛痛痛痛痛痛痛痛痛痛痛痛痛痛痛。"
			},
            {
				"name": "Lawrence",
				"ans": "她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "Bob",
				"ans": "因為她肚子痛。"
			},
            {
				"name": "Kevin",
				"ans": "她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "John",
				"ans": "因為她肚子痛。"
			},
			{
				"name": "Merry",
				"ans": "她喝太多咖啡了，肚子痛。"
			},
			{
				"name": "Alex",
				"ans": "她胃痛，所以不能吃飯。"
			},
			{
				"name": "Natividad",
				"ans": "她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了她喝太多咖啡了，肚子痛。"
			},
		]; 
	}
	if(ansMethod ==='check'){
		DataSans = [
            {
                "name": "Merry",
                "ans": "她肚子痛。"
            },
            {
                "name": "Kevin",
                "ans": "她肚子痛。"
            },
            {
                "name": "Lawrence",
                "ans": "因為她正在減肥。"
            },
            {
                "name": "OliverOliver Oliver",
                "ans": "她等一下吃。"
            },
            {
                "name": "Taylor Alison Swift",
                "ans": "她等一下吃。"
            },
            {
                "name": "Peter Gene Hernandez",
                "ans": "她等一下吃。"
            },
            {
                "name": "Halsey",
                "ans": "她喝太多咖啡了。"
            },
            {
                "name": "Kelly Clarkson",
                "ans": "她喝太多咖啡了。"
            },
            {
                "name": "Justin",
                "ans": "她喝太多咖啡了。"
            },
            {
                "name": "Amy",
                "ans": "她喝太多咖啡了。"
            },
            {
                "name": "Brian",
                "ans": "她喝太多咖啡了。"
            },
            {
                "name": "Christina C. Kathy",
                "ans": "她喝太多咖啡了。"
            },
            {
                "name": "Daren D. Daren",
                "ans": "因為她正在減肥。"
            },
            {
                "name": "Eddie Van Halen",
                "ans": "因為她正在減肥。"
            },
            {
                "name": "Karen",
                "ans": "她肚子痛。"
            },
            {
                "name": "Zoe",
                "ans": "她喝太多咖啡了。"
            },
            {
                "name": "Bob",
                "ans": "她喝太多咖啡了。"
            },
            {
                "name": "John",
                "ans": "她喝太多咖啡了。"
            },
            {
                "name": "Alex",
                "ans": "她喝太多咖啡了。"
            },
            {
                "name": "Natividad",
                "ans": "她喝太多咖啡了。"
            }
        ];  
	}
	
	let i = 0;
    
    const content = document.querySelector('.ansMethod.type .row');
    content.innerHTML = '';
    let html = '';

    let intervalId = setInterval(() => {
        //demo20人，若等不及開始，則完成人數不超過參加人數
		if (i >= DataSans.length || i >= JOINNUM.textContent) {
			clearInterval(intervalId);
			return;
		}

		if(ansMethod === 'type'){
            let collapseBtn = document.querySelector('.ansMethod.type .CA-collapse-list');
            let collapseExpanded = collapseBtn.getAttribute('aria-expanded'); 
            
            //判斷展開/隱藏狀態，給予html
            if(collapseExpanded == 'true'){ //展開狀態中
                 html = `<div class="col">
                            <div class="CA-dialogueChat">
                                <div class="dialogueChat-name collapse show">` + DataSans[i].name + `</div>
                                <div class="dialogueChat-text">` + DataSans[i].ans + `</div>
                            </div>
                        </div>`;
            } else if (collapseExpanded == 'false') { //隱藏狀態中
                html = `<div class="col">
                            <div class="CA-dialogueChat">
                                <div class="dialogueChat-name collapse">` + DataSans[i].name + `</div>
                                <div class="dialogueChat-text">` + DataSans[i].ans + `</div>
                            </div>
                        </div>`;
            }
            
            content.insertAdjacentHTML('beforeend', html);
            
            //完成人數
		    doneNum(ansMethod, i);
            
            //卷軸保持在下方
		    scrollToBottom(); 
		}
        
		if(ansMethod === 'check'){ 
            const ansValue = DataSans[i].ans;  
            const polls = document.querySelectorAll('.CA-poll-bar');
            
            //寫值
            polls.forEach(poll => {
                let title = poll.querySelector('.poll-bar-title span:nth-child(2)');

                //選項=學生答案
                if (title && title.textContent === ansValue) {
                    let name = poll.querySelector('.poll-bar-name');
                    let bar = poll.querySelector('.poll-bar-bar');

                    //寫入名字
                    if (name && name.textContent === "") {
                        name.textContent = DataSans[i].name;
                    } else if (name) {
                        name.textContent += `, ${DataSans[i].name}`;
                    }

                    //寫入bar百分比
                    if (name && bar) {
                        let nameCount = name.textContent.trim().split(',').length;
                        let percentage = Math.floor((nameCount / document.querySelector('#JOINNUM').textContent) * 100);

                        bar.style.width = `${percentage}%`;
                        bar.querySelector('span').textContent = `${percentage}%`;
                    }
                } 
            });

            //百分比最高則增加.top1特別色
            let maxBarWidth = 0;
            let topBarParent = null;

            for (let i = 0; i < polls.length; i++) {
                let aBar = polls[i].querySelector('.poll-bar-bar');
                let barWidth = parseFloat(aBar.style.width);

                if (barWidth > maxBarWidth) {
                    maxBarWidth = barWidth;
                    topBarParent = polls[i];
                }
            }

            for (let i = 0; i < polls.length; i++) {
                polls[i].classList.remove('top1');
            }

            topBarParent.classList.add('top1');
            
            //完成人數
		    doneNum(ansMethod, i);
		}

		i++;
	}, 1200);
	
	NEXT.addEventListener('click', () => {
		clearInterval(intervalId);	  
	});
}
    
//判斷是否在題目時間點上，是則暫停播放
function matchTopic(){
    let index = dataQ.topics.findIndex(topic => topic.sec === progress.slider('value'));
    let topicData = index !== -1 ? dataQ.topics[index] : null;
    
    if (topicData) {  
        player.pauseVideo(); 
        
        //顯示按鈕文字
        showBtn(currentIndex+1);
    }else{
        showVIDEO();
    } 
}   

//暫停時偵測是否在題目時間點上，若是則顯示題目及模擬學生作答    
function matchPause(){
    let index = dataQ.topics.findIndex(topic => topic.sec === progress.slider('value'));
    let topicData = index !== -1 ? dataQ.topics[index] : null;
    if (topicData) { 
        showTopic(index);
        demoSans(dataQ.topics[index].ansMethod); 
        
        clearTimer();
        //倒數秒數
        countdownTimer(dataQ.topics[index].ansMin, dataQ.topics[index].ansSec);
    }
}     

let currentIndex = 0;    
showSTEP1();
showBtn(currentIndex);
demoSenter();
   

//[開始][下一題][完成]
NEXT.addEventListener('click', (e) => {  
    if(!playerInitialized){
        onYouTubeIframeAPIReady(dataQ.ytId, dataQ.clipStart, dataQ.clipEnd);  
    }
    
	if( JOINNUM.textContent === '0' ){
		alert('請等待所有人加入再開始。');
	}else { 
        //[開始]後，版型比例修改
        if(currentIndex === 0){
            document.querySelector('.bg-grid').classList.replace('col-lg-4', 'col-lg-3'); 
            document.querySelector('.bg-grid').classList.add('col-xxl-2'); 
            document.querySelector('.bg-pure').classList.replace('col-lg-8', 'col-lg-9');
            document.querySelector('.bg-pure').classList.add('col-xxl-10');
        } else { 
            player.playVideo();
        }
        
        showVIDEO();
        DONENUM.innerHTML='0';
        currentIndex++;
	} 
}); 
    
//[關閉視窗]   
CLOSEWIN.addEventListener('click', ()=>{
    window.close();
}); 
    
//[播放] 
$('.em-play').click(function () {
    if (playerInitialized) {
        player.playVideo();
        showVIDEO();
    }
});
//[暫停] 
$('.em-pause').click(function () {
    if (playerInitialized) {
        player.pauseVideo();
    }
});     
</script>
    
<script> 
//This function creates an <iframe> (and YouTube player) after the API code downloads. 
function onYouTubeIframeAPIReady(videoId, start=0, end) { 
    if(videoId){
        player = new YT.Player('ytplayer', {
            height: '360',      //預設，但bootstrap會自動縮放
            width: '640',       //預設，但bootstrap會自動縮放
            videoId: videoId,
            playerVars: {
                'autoplay': 0,
                'controls': 0,
                'enablejsapi': 1,
                'start': start,
                'end': end
            },
            events: {
                'onReady': function(event) {
                    event.target.setPlaybackQuality('large');
                    onPlayerReady(event, start, end);
                },
                'onStateChange': function(event) {
                    onPlayerStateChange(event, start, end);
                }
            }
        });  
    }
} 
    
function onPlayerReady(event, start, end) {  
    playerInitialized = true;
    
    var videoData = player.getVideoData();    
     
    //顯示YT影片縮圖，以隱藏YT play icon
    $('#ytDefault').attr('src', 'https://img.youtube.com/vi/' + videoData.video_id + '/hqdefault.jpg').show();

    //重製播放秒數
    $('.em-player__Nowsec').text('00:00');

    //總時長秒數   
    if (!end) {
        end = player.getDuration() - 1; // 若end為空，則為影片的總時長 (誤差一秒)
    }                                     
    var playerDuration = end - start;
    $('.em-player__totalSec').text( formatTime(playerDuration) );

    //進度條slider 
    progressSlider(player, start, end); 
    
    //增加題目時間點
    for(let i=0; i<dataQ.topics.length; i++){
        let sec = dataQ.topics[i].sec;
        AddTopicTime(progress, sec);            
    }
}  
    
function onPlayerStateChange(event, start, end) {  
    if (event.data === YT.PlayerState.PLAYING) { 
        if (!end) {
            end = player.getDuration() - 1; // 若end為空，則為影片的總時長 (誤差一秒)
        } 
                                                
        clearInterval(interval);
        //目前播放秒數
        interval = setInterval(function() {
            updatePlayerInfo(start, end);
        }, 1000);
        
        //更換按鈕、隱藏YT影片縮圖
        $('.em-pause').show().siblings('.em-btn').hide();
        $('#ytDefault').hide();
    } else if (event.data === YT.PlayerState.PAUSED) { 
        //更換按鈕、隱藏YT影片縮圖
        $('.em-play').show().siblings('.em-btn').hide();
        $('#ytDefault').hide();
        
        //暫停時偵測是否在題目時間點上，若是則開始模擬學生作答
        matchPause();                                             
                                                      
    } else if (event.data === YT.PlayerState.ENDED) {  
        //更換按鈕、顯示YT影片縮圖
        $('.em-play').show().siblings('.em-btn').hide();
        $('#ytDefault').show();
        
        //結束播放後出現活動完成畫面??
        endModal.show();                                                                                       
    }
} 
    
function updatePlayerInfo(start, end) { 
    if (playerInitialized) {
        var currentTime = player.getCurrentTime();      //目前yt時間
        var duration = end - start;                     //目前播放總時長 
        var playTime = currentTime - start;             //目前播放時間
        var percentage = (playTime / duration) * 100;
        
        //目前播放時間
        $('.em-player__Nowsec').text( formatTime(currentTime - start) );
        
        //進度條
        progress.slider('value', currentTime); 
        
        //判斷是否播放到題目時間點上
        matchTopic();
    }
}     
    
//進度條slider    
function progressSlider(player, start, end){ 
    progress.slider({
        range: 'min',
        min: start,
        max: end,
        create: function (event, ui) {
        },
        slide: function( event, ui ) {  
            //滑動時更新當前秒數
            $('.em-player__Nowsec').text( formatTime(player.getCurrentTime()) );
            
            //滑動時更新時間軸、播放該時間影片
            progress.slider('value', ui.value);                          
            player.seekTo(ui.value);
            
            //滑動時判斷是否滑到題目時間點上
            matchTopic();       
        }
    });
}
    
//新增題目時間點
function AddTopicTime(progress, sec){ 
    //若秒數在播放時間軸內，則增加節點
    let progressMin = progress.slider('option', 'min'),
        progressMax = progress.slider('option', 'max'); 
                             
    if( sec >= progressMin && sec <= progressMax ){
        let percentage = ((sec - progressMin) / (progressMax - progressMin)) * 100; 
        progress.append('<span class="ui-slider-topic" style="left: ' + percentage + '%;"></span>');
    }                       
}       
    
//格式化時間 MM:SS
function formatTime(seconds) {
    var date = new Date(null);
    date.setSeconds(seconds);
    return date.toISOString().substr(14, 5);
}        
</script>        
</body>
</html>

<!doctype html>
<html lang="zh-tw">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="eMPOWER華語文字詞句教學平台">
<meta name="author" content="eMPOWER華語文字詞句教學平台">
<title>eMPOWER華語文字詞句教學平台</title>
<link rel="shortcut icon" type="image/x-icon" href="../Content/images/eMPOWER.ico">
<link rel="stylesheet" type="text/css" href="../Content/css/bootstrap-lg.min.css">
<link rel="stylesheet" type="text/css" href="../Content/css/ie10-viewport-bug-workaround.css">
<link rel="stylesheet" type="text/css" href="../Content/widgets/fontawesome-free-5.15.3-web/css/all.css">

<!-- this page widgets CSS -->
<link rel="stylesheet" type="text/css" href="../Content/widgets/bootstrap-fileinput-master/css/fileinput-eM.css">
<!-- my core CSS -->
<link rel="stylesheet" type="text/css" href="../Content/css/eMPOWERstyles.css">
</head>

<body>
<header>
  <nav class="navbar navi-main navbar-fixed-top">
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">展開上方主選單</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar" aria-expanded="false" aria-controls="sidebar"> <span class="sr-only">展開左側選單</span> <i class="fas fa-chevron-right"></i><i class="fas fa-chevron-left"></i></button>
            <a class="navbar-brand" href="#"> <img src="../Content/images/eMPOWER-img.svg" alt="eMPOWER華語文字詞句教學平台" class="img-responsive"> </a>
            <h1>eMPOWER華語文字詞句教學平台</h1>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="navTab-Tindex"><a href="Tindex.html">首頁</a></li>
              <li class="navTab-chineseSeries"><a href="chineseSeries.html">華語教材系列</a></li>
              <li class="navTab-customized"><a href="customized.html">建立自編教材</a></li>
              <li class="navTab-myLibs"><a href="myLibs.html">我的教材庫</a></li>
              <li class="navTab-classMgt dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">班級管理&nbsp;<span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="classMgt__students.html">學生名單</a></li>
                  <li><a href="classMgt__groups.html">指派教材</a></li>
                  <li><a href="classMgt__learning.html">學習紀錄</a></li>
                  <li><a href="classMgt__score.html">評量結果</a></li>
                </ul>
              </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li class="dropdown"><a class="navi-main__loginedBtn" data-target="#" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">你好，張花花！</a>
                <ul class="dropdown-menu navi-main__userMenu">
                  <li><a href="../index.html" class="btn navi-main__logoutBtn">登出</a></li>
                </ul>
              </li>
              <li class="dropdown"><a class="navi-main__languageBtn" data-target="#" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">中文(正體)&nbsp;<span class="caret"></span></a>
                <ul class="dropdown-menu navi-main__languageMenu">
                  <li><a href="" check="checked"><span class="language-icon"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></span>&nbsp;中文(正體)</a></li>
                  <li><a href=""><span class="language-icon"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></span>&nbsp;中文(简体)</a></li>
                  <li><a href=""><span class="language-icon"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></span>&nbsp;English(United States)</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<!-- ------- ------- ------- ------- ------- ------- ------- -->
<main>
  <div class="container-fluid">
    <div class="row"> 
      <!-- 左邊選單start -->
      <div class="col-sm-3 col-md-2 sidebar navbar-collapse collapse" id="sidebar">
        <div class="editUnit-item">
          <h3 class="textbookName">中文真有趣</h3>
          <div class="unitFront">
            <div class="embed-responsive embed-responsive-16by9"> <img src="../Content/images/default-unit.png" class="embed-responsive-item" alt="單元封面"> </div>
          </div>
          <h4 class="unitName">第一課 問好</h4>
        </div>
      </div>
      <!-- 左邊選單end --> 
      <!-- 右邊內容start -->
      <div class="col-sm-12 col-md-10 col-md-offset-2 sidebar-main">
        <div class="sidebar-main-block"> 
          <!-- 標題 -->
          <h2 class="text-cyan editUnit-title"> <span class="bg-cyan editUnit-icon"><img src="../Content/images/libs/classActivity.svg" alt="課堂活動圖示"/></span>課堂活動</h2>
          <!-- 內容 -->
          <div class="editUnit-content editCourse-content__classActivity">
            <h3 class="editUnit-subtitle"><img src="../Content/images/classActivity/poll-icon.png"  height="40" alt="pollIcon" class="mr-1"/>選你所想</h3>
            <div class="editCourse-CWSblock Qnumber-block">
              <div class="editCourse-tab Qnumber-tab">
                <ul class="nav nav-tabs" role="tablist">
                  <li role="presentation"><a href="#link0" aria-controls="link0" role="tab" data-toggle="tab">
                    <div class="tab-title">1</div>
                    </a>
                    <button class="Qnumber-btn-delete"><i class="fas fa-times"></i></button>
                  </li>
                  <button class="Qnumber-btn-add" id="insertQnumber"><i class="fas fa-plus"></i>&nbsp;新增題目</button>
                </ul>
              </div>
              <div class="editCourse-tab-content Qnumber-tab-content">
                <div class="tab-content">
                  <div role="tabpanel" class="tab-pane" id="link0">
                    <div class="form-horizontal form-style-2 pt-5">
                      <div class="form-group"> <label class="col-md-3 col-lg-2 pr-0 control-label"><span class="text-red">*</span>題目</label>
                        <div class="col-md-9 col-lg-9 col-xl-8">
                          <textarea class="form-control" rows="5" id="topic0" placeholder="請在此輸入題目..." ></textarea>
                        </div>
                      </div>
                      <div class="form-group"> <label class="col-md-3 col-lg-2 pr-0 control-label">題目圖片</label>
                        <div class="col-md-9 col-lg-9 col-xl-8">
                          <div class="row px-2">
                            <div class="col-xs-12 mb-3 col-xsm-4 px-1 col-sm-4 mb-sm-0">
                              <input type="file" id="uploadPics`+ n +`-1">
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="form-group"> <label class="col-md-3 col-lg-2 pr-0 control-label"><span class="text-red">*</span>選項</label>
                        <div class="col-md-9 col-lg-9 col-xl-8">
                          <ul class="list-group mt-n2 CApoll-answerSort">
                            <li class="list-group-item noBorder px-0">
                              <div class="align-items-center">
                                <div class="input-group"> <span class="input-group-addon">A.</span>
                                  <input type="text" class="form-control" placeholder="請輸入選項...">
                                  <span class="input-group-btn">
                                  <button class="btn btn-default" type="button">×</button>
                                  </span> </div>
                              </div>
                            </li>
                            <li class="list-group-item noBorder px-0">
                              <div class="align-items-center">
                                <div class="input-group"> <span class="input-group-addon">B.</span>
                                  <input type="text" class="form-control" placeholder="請輸入選項...">
                                  <span class="input-group-btn">
                                  <button class="btn btn-default" type="button">×</button>
                                  </span> </div>
                              </div>
                            </li>
                            <li class="list-group-item noBorder px-0">
                              <div class="align-items-center">
                                <div class="input-group"> <span class="input-group-addon">C.</span>
                                  <input type="text" class="form-control" placeholder="請輸入選項...">
                                  <span class="input-group-btn">
                                  <button class="btn btn-default" type="button">×</button>
                                  </span> </div>
                              </div>
                            </li>
                          </ul>
                          <div class="mt-n2">
                            <button class="btn btn-default text-gray btn-block btn-addOption"><i class="fas fa-plus"></i>&nbsp;增加選項</button>
                          </div>
                        </div>
                      </div>
                      <div class="form-group"> <label class="col-md-3 col-lg-2 pr-0 control-label"><span class="text-red">*</span>作答時間</label>
                        <div class="col-md-9 col-lg-9 col-xl-8">
                          <input type="text" class="form-control" style="display: inline-block; width: 50px;" id="ansTimeMin0">
                          &nbsp;分&nbsp;&nbsp;
                          <input type="text" class="form-control" style="display: inline-block; width: 50px;" id="ansTimeSec0">
                          &nbsp;秒 </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- 按鈕 -->
          <div class="row classActivity__tools" style="">
            <div class="col-xs-12 col-sm-6 text-left"> <a class="btn btn-main-cyan-white btn-lg" role="button" href="editUnit__activity.html" id="BACK">返回課堂活動</a> </div>
            <div class="col-xs-12 col-sm-6 text-right"> <!--<a class="btn btn-main-cyan btn-lg" role="button" target="_blank" href="../STUDENT/CLASS_ACTIVITY/poll.html?user=t" id="PREVIEW">預覽選你所想</a>--> <a class="btn btn-main-cyan btn-lg" role="button" href="editUnit__activity.html" id="SAVE">儲存</a> </div>
          </div>
          <!-- --> 
        </div>
      </div>
      <!-- 右邊內容end --> 
    </div>
  </div>
</main>
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<script src="../Script/jquery.min.js"></script> 
<script src="../Script/bootstrap.min.js"></script> 
<script src="../Script/ie10-viewport-bug-workaround.js"></script> 
<!-- widgets js --> 
<script src="../Content/js/defaultText.js">//預設圖片+單元名</script> 
<script src="../Content/js/getSearch.js">//取得URL search</script> 
<script src="../Content/widgets/jquery-ui-1.12.1.custom/jquery-ui.min.js">//頁籤拖曳</script> 
<script src="../Content/widgets/jquery-ui-1.12.1.custom/jquery.ui.touch-punch.min.js">//手機拖曳</script> 
<script src="../Content/widgets/bootstrap-fileinput-master/js/fileinput.js"></script> 
<script src="../Content/widgets/bootstrap-fileinput-master/js/locales/zh-TW.js"></script> 
<script src="../Content/widgets/bootstrap-fileinput-master/themes/fa/theme.min.js"></script> 
<script>
$(document).ready(function() {
	//nowPage 
	$('.navTab-myLibs').addClass('active');
    
    //僅demo模擬，正式請刪除。/////////////////////////////////////////////////
    var oriSearch = GetQueryString('activity');

    //[返回] 連結帶?activity
    $('#BACK').click(function(e){
        e.preventDefault();
        window.location.href = $(this).attr('href') + '?activity=' + oriSearch;
    });   

    //[預覽] 
    $('#PREVIEW').click(function(e){
        e.preventDefault();

        //do something... (判斷*是否有填)
        let Validation = true;
        if( Validation != true ){
            alert('*不可空白。');
        }else{
            window.open( $(this).attr('href') , '_blank');   
        } 
    }); 

    //[儲存] 
    $('#SAVE').click(function(e){
        e.preventDefault();

        //do something... (驗證欄位是否有填及正確)

        alert('成功儲存選你所想。\n可至單元-課堂活動開啟活動。'); 

        var activityID = '5';
        window.location = $(this).attr('href') + '?activity=' + oriSearch + 'a'+ activityID;
    });  
	
	//demo用 清空模板
	$('.Qnumber-tab .nav-tabs').html(`<button class="Qnumber-btn-add" id="insertQnumber"><i class="fas fa-plus"></i>&nbsp;新增題目</button>`);
	$('.Qnumber-tab-content .tab-content').html('');
    
    //目前有num題
    let num = 0;
    
    //若為0題，則預設有一空白tab
    if( num === 0 ){
        num = 1; 
    }else{
		//do something... (若有多題，則需載入資料)	
	}
    
    //產生題目框架 
    for( let i = 0; i < num; i++ ){ 
        createTab(i);
        
        //載入Fileinput
        loadFileinput('uploadPics'+ i);
    }
    
    //active tab、tab-content
    $('.Qnumber-tab .nav-tabs')
        .find( 'li:nth-child('+ num +')').addClass('active');
    $('.Qnumber-tab-content .tab-content')
        .find('.tab-pane#link'+ Number(num-1)).addClass('active');
    
    //[新增題目]
    $('#insertQnumber').click(function(){ 
        let numLength = $('.Qnumber-block .Qnumber-tab .nav-tabs li').length; 
        
        createTab(numLength);
        
        //載入Fileinput
        loadFileinput('uploadPics'+ numLength);
        
        //active tab、tab-content
        $('.Qnumber-tab .nav-tabs')
            .find( 'li:nth-child('+ Number(numLength+1) +')').addClass('active').siblings().removeClass('active');
        $('.Qnumber-tab-content .tab-content')
            .find('.tab-pane#link'+ numLength).addClass('active').siblings().removeClass('active');
    });
    
    //拖曳更換題號順序
    $('.Qnumber-tab .nav-tabs').sortable({
        items: '> li',
        cancel: 'button',
        placeholder: 'ui-sortable-placeholder',
        start: function(e, ui) {
            //佔位符號寬度=拖曳物件
            ui.placeholder.width(ui.item.width());
        },
        update: updateTopic,
        stop: function(event, ui) {
            //拖動完成後，拖曳物件加上active
            ui.item.addClass('active').siblings().removeClass('active');
            $( ui.item.find('a').attr('href') ).addClass('active').siblings().removeClass('active');
        },
    });
});

//產生內容    
function createTab(n){
    //tab內容 
    $('.Qnumber-tab .nav-tabs').find('.Qnumber-btn-add')
        .before(`<li role="presentation"><a href="#link`+ n +`" aria-controls="link`+ n +`" role="tab" data-toggle="tab">
                    <div class="tab-title">`+ Number(n+1) +`</div>
                    </a>
                    <button class="Qnumber-btn-delete"><i class="fas fa-times"></i></button>
                 </li>`);
    
    //刪除按鈕綁定刪除
    $('.Qnumber-btn-delete').click(function(e){
        deleteTopic(e);
    });
    
    //tab-content內容 
    $('.Qnumber-tab-content .tab-content')
        .append(`<div role="tabpanel" class="tab-pane" id="link`+ n +`">
                    <div class="form-horizontal form-style-2 pt-5">
                      <div class="form-group"> <label class="col-md-3 col-lg-2 pr-0 control-label"><span class="text-red">*</span>題目</label>
                        <div class="col-md-9 col-lg-9 col-xl-8">
                          <textarea class="form-control" rows="5" id="topic`+ n +`" placeholder="請在此輸入題目..." ></textarea>
                        </div>
                      </div>
                      <div class="form-group"> <label class="col-md-3 col-lg-2 pr-0 control-label">題目圖片</label>
                        <div class="col-md-9 col-lg-9 col-xl-8">
                            <div class="row px-2">
                                <div class="col-xs-12 mb-3 col-xsm-4 px-1 col-sm-4 mb-sm-0">
                                    <input type="file" id="uploadPics`+ n +`">
                                </div>
                            </div>
                        </div>
                      </div>
                      <div class="form-group"> <label class="col-md-3 col-lg-2 pr-0 control-label"><span class="text-red">*</span>選項</label>
                        <div class="col-md-9 col-lg-9 col-xl-8">
                          <ul class="list-group mt-n2 CApoll-answerSort">
                            <li class="list-group-item noBorder px-0">
                              <div class="align-items-center">  
                                <div class="input-group"> <span class="input-group-addon">A.</span>
                                  <input type="text" class="form-control" placeholder="請輸入選項...">
                                  <span class="input-group-btn">
                                    <button class="btn btn-default" type="button">×</button>
                                  </span> 
                                </div>
                              </div>
                            </li>
                            <li class="list-group-item noBorder px-0">
                              <div class="align-items-center">
                                <div class="input-group"> <span class="input-group-addon">B.</span>
                                  <input type="text" class="form-control" placeholder="請輸入選項...">
                                  <span class="input-group-btn">
                                    <button class="btn btn-default" type="button">×</button>
                                  </span> 
                                </div>
                              </div>
                            </li>
                            <li class="list-group-item noBorder px-0">
                              <div class="align-items-center">
                                <div class="input-group"> <span class="input-group-addon">C.</span>
                                  <input type="text" class="form-control" placeholder="請輸入選項...">
                                  <span class="input-group-btn">
                                    <button class="btn btn-default" type="button">×</button>
                                  </span>   
                                </div>
                              </div>
                            </li> 
                          </ul>
                          <div class="mt-n2"><button class="btn btn-default text-gray btn-block btn-addOption"><i class="fas fa-plus"></i>&nbsp;增加選項</button> </div>
                        </div>
                      </div>
                      <div class="form-group"> <label class="col-md-3 col-lg-2 pr-0 control-label"><span class="text-red">*</span>作答時間</label>
                        <div class="col-md-9 col-lg-9 col-xl-8">
                            <input type="text" class="form-control" style="display: inline-block; width: 50px;" id="ansTimeMin`+ n +`">
                            &nbsp;分&nbsp;&nbsp;
                            <input type="text" class="form-control" style="display: inline-block; width: 50px;" id="ansTimeSec`+ n +`">
                            &nbsp;秒
                        </div>
                      </div>  
                    </div>
                  </div>`); 
    
    //增加選項
    $('.btn-addOption').click(function(e){
        addOption(e);
    });
    
    //拖曳更換答案設定順序  
    sortOption();
}
    
//刪除題目
function deleteTopic(e) { 
    let totalNum = $(e.target).parents('.nav-tabs').find('li').length; 
    
    let delLi    = $(e.target).parents('li'),          
        delIndex = delLi.index(), 
        delNum   = delLi.find('.tab-title').text(),
        delControl = delLi.find('a').attr('href');
    
    if( totalNum === 1 ){ //只有一題，刪除改為清空內容
        if( confirm('是否確定清空第 '+ delNum +' 題？') ){  
            $(delControl).find('input, textarea').val('');
            $(delControl).find('input[type="radio"]').prop('checked', false);
            $(delControl).find('input[type="file"]').fileinput('clear');
        }    
    }else{
        if( confirm('是否確定刪除第 '+ delNum +' 題？\n題目：'+ $(delControl).find('textarea').val().substr(0, 20) +'......') ){
            if( delNum == totalNum ){ //若為最後一個tab，刪除後將前一個tab+.active
                $(delLi).prev().addClass('active');
                $(delControl).prev().addClass('active');    
            }else{ //刪除後將後一個tab+.active
                $(delLi).next().addClass('active'); 
                $(delControl).next().addClass('active'); 
            }
            
            $(delLi).remove();
            $(delControl).remove();
            
            updateTopic();
        }     
    }
}   
    
//增加選項
function addOption(e){
    let topicIndex = $(e.target).parents('.tab-pane').attr('id').substr(4);  

    let target = $(e.target).parent().prev('ul'),
        targetLenght = target.find('li').length;
    
    let addNum = (targetLenght+1),
        addString = String.fromCharCode(addNum + 64);

    target.append(`<li class="list-group-item noBorder px-0">
                      <div class="align-items-center">
                        <div class="input-group"> <span class="input-group-addon">`+ addString +`.</span>
                          <input type="text" class="form-control" placeholder="請輸入選項...">
                          <span class="input-group-btn">
                            <button class="btn btn-default" type="button">×</button>
                          </span> 
                        </div>
                      </div>
                    </li> `);
}    
    
//更新Tab題號    
function updateTopic() { 
    let sortedItems = $('.Qnumber-tab .nav-tabs').find('li');
    sortedItems.each(function(index) {
        $(this).find('.tab-title').text((index + 1));
    });
}    
    
//載入Fileinput  
function loadFileinput(idName){
    $('#'+idName).fileinput({
        language: 				'zh-TW',
        theme: 'fa',
        allowedFileExtensions: 	['jpg', 'png','jpeg'],	//接收的檔案字尾
        maxFileSize: 			2048,				    //單位為kb，如果為0表示不限制檔案大小
        maxFileCount:			1,					    //表示允許同時上傳的最大檔案個數
        
        browseOnZoneClick:      true,                   //是否點擊預覽區域時觸發文件選擇
        dropZoneTitle:          '拖曳或選擇您裝置裡的圖片<span>(限2MB)</span>', //拖放區域的標題
        dropZoneClickTitle:     '',                     //拖放區域的拖曳標題
        
        autoReplace:            true,                   //是否自動替換預覽中的文件
        uploadUrl:              "/Content/temp",
        uploadAsync:            false,
        
        showClose:              false,                  //是否顯示預覽界面的關閉圖標
        showCaption:			false,                  //是否顯示文件名
        showRemove:			    false,                  //是否顯示刪除钮
        showUpload:			    false,                  //是否顯示文件上傳按鈕
        showBrowse:			    false,                  //是否顯示文件瀏覽按钮
        showDrag:               true,                   //是否在縮略圖中顯示拖動按鈕（僅適用於初始預覽內容）

        previewClass:           'file-eMstyle-dropOnly',//預覽容器樣式
        previewSettings: {
            image: {width: 'auto', height: '200px', 'max-width': '100%', 'max-height': '100%'},
        },
        layoutTemplates: {
            footer:  '<div class="file-thumbnail-footer">\n' +
                '    {progress}\n{actions}\n' +
                '</div>',
            actions: '<div class="file-actions">\n' +
                    '    <div class="file-footer-buttons">\n' +
                    '        {delete} {zoom} ' +
                    '    </div>\n' +
                    '</div>\n' +
                    '{drag}\n' +
                    '<div class="clearfix"></div>',
            modal: '<div class="modal-dialog modal-lg{rtl}" role="document">\n' +
                    '  <div class="modal-content">\n' +
                    '    <div class="modal-header kv-zoom-header">\n' +
                    '      <h6 class="modal-title kv-zoom-title"><span class="kv-zoom-caption"></span> <span class="kv-zoom-size"></span></h6>\n' +
                    '      <div class="kv-zoom-actions">{close}</div>\n' +
                    '    </div>\n' +
                    '    <div class="floating-buttons"></div>\n' +
                    '    <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"></div>\n' + '{prev} {next}\n' +
                    '    <div class="kv-zoom-description"></div>\n' +
                    '  </div>\n' +
                    '</div>\n',
        },
        fileActionSettings: {
            showRemove: true,
            removeClass: 'btn btn-main-cyan btn-xs',
            zoomClass: 'btn btn-main-cyan btn-xs',
        },
        previewZoomButtonIcons: {
            close: '<i class="fas fa-times"></i>'    
        }
	});
}   
    
//拖曳更換答案設定順序   
function sortOption(){
    $('.CApoll-answerSort').sortable({
        items: '> li',
        placeholder: 'ui-sortable-placeholder',
        start: function(e, ui) {
            //佔位符號寬度=拖曳物件
            ui.placeholder.width(ui.item.width());
            ui.placeholder.height(ui.item.height());
        },
        update: function(event, ui) {
            var $listGroup = $(this);

            $listGroup.find('li').each(function(index) {
                $(this).find('input[type="radio"]').val(String.fromCharCode(65 + index));
                $(this).find('.input-group-addon').text(String.fromCharCode(65 + index) + '.');
            });
        },
    });
}   
</script>
</body>
</html>
